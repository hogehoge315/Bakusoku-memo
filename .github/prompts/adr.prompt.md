---
agent: iOS Architect
description: アーキテクチャ上の設計判断を ADR 形式で memory/decisions.md に記録する
tools:
  - read/readFile
  - edit/editFiles
  - search/codebase
model: Claude Sonnet 4.6 (copilot)
---

## タスク

設計判断を Architecture Decision Record（ADR）として `memory/decisions.md` に記録してください。

### Step 1: 既存ADRを確認

`memory/decisions.md` を読んで：

1. 既存のADR番号（最後の番号）を確認する
2. 同じ内容の決定が既に記録されていないか確認する

### ✅ バリデーションゲート 1: ADR 作成前確認

ADR を作成する前に以下を確認すること。ひとつでも❌ならユーザーに確認を求める。

- [ ] `memory/decisions.md` を読んで最後のADR番号を確認した
- [ ] 同内容のADRが既存しない
- [ ] 記録する判断の「状況」（なぜこの決定が必要か）が明確になっている

### Step 2: ADR を作成

以下のテンプレートで次の番号（ADR-XXX）のエントリを作成する：

```markdown
---

## ADR-[番号]: [タイトル（動詞+名詞で簡潔に）]

- **日付**: YYYY-MM-DD
- **状況**: [なぜこの決定が必要になったか。どんな問題や文脈があったか]
- **決定**: [何を決めたか。1〜2文で簡潔に]
- **理由**: [なぜそう決めたか。技術的・UX的・制約的な根拠]
- **代替案**: [検討したが採用しなかった選択肢と、却下した理由]
- **結果**: [この決定によってどんな影響・トレードオフが生じるか]
```

### Step 3: BakusokuMemoApp 固有の制約チェック

ADR が以下の絶対ルールに違反していないか確認する：

- `SystemLanguageModel` フォールバック不採用の方針（ADR-003）と矛盾しないか
- Foundation Models 採用（ADR-004）と整合しているか
- actor 設計（ADR-005）と一貫しているか

違反する場合はユーザーに確認を求める。

### ✅ バリデーションゲート 2: 追記前確認

`memory/decisions.md` への追記前に以下をすべて確認すること。ひとつでも❌なら修正してから追記する。

- [ ] ADR-003（フォールバック不採用）と矛盾しない
- [ ] 「選択しなかった代替案」に根拠が明記されている
- [ ] ADR番号が正しい（現在最大番号+1）
- [ ] 6つの必須フィールド（日付・状況・決定・理由・代替案・結果）がすべて埋まっている

`memory/decisions.md` の末尾に `---` 区切り線と新しいADRを追記する。既存の内容は削除・変更しない。

### 良いADRの例

```markdown
## ADR-006: MemoInputView はシートではなくフルスクリーンカバーを使用

- **日付**: 2026-02-21
- **状況**: メモ入力画面をどのモーダル形式で表示するか決める必要があった
- **決定**: `.fullScreenCover` を使いフルスクリーンで入力画面を表示する
- **理由**: フルスクリーンの方がキーボード表示時のレイアウト計算がシンプル。高速起動UXのために画面全体を入力に使いたい
- **代替案**: `.sheet`（却下: キーボード表示時にシートが縮小されUIが複雑になる）
- **結果**: 入力画面が常にフル画面で表示される。戻る操作は swipe-down またはキャンセルボタン
```
